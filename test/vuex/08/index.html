<html>
    <head>
        <meta charset="utf-8">
        <title>课程8</title>
        <!-- <script src="https://unpkg.com/vue"></script>
        <script src="https://unpkg.com/vuex"></script> -->
        <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://unpkg.com/vuex@3.0.1/dist/vuex.js"></script>
    </head>
    <dvi id="app"></dvi>
    <script>
        const Counter = {
            methods:Vuex.mapActions(["increment"]),
            // methods:Vuex.mapActions({
            //     addCount: 'increment',
            // }) ,
            template:`
            <div>
                {{$store.state.count}}
                <button @click=increment>Add </button>
            </div>
            `
        }
        const store = new Vuex.Store({
            state: {
                count: 0,
            },
            mutations: {
                increment(state){
                    state.count ++
                }
            },
            actions: {
                increment(context){
                    context.commit('increment')
                },
                incrementAsync({commit}){
                    return new Promise ((resolve, reject)=>{
                        setTimeout(() => {
                        commit('increment')
                        resolve()
                    }, 2000)
                    })
                    
                }
            }
        })
        // store.commit("increment");
        // store.dispatch("increment");
        const app = new Vue({
            el: "#app",
            store,
            computed: Vuex.mapState(['count']),
            components: {
                'counter': Counter,
            },
            template:'\
            <div>\
                <counter></counter>\
            </div>'
        })
        async function test(){
            console.log("run in test 01")
            await store.dispatch("incrementAsync")
            console.log("run in test 02")

            store.dispatch('increment')
            console.log("run in test 03")
        }
        test()
    </script>
</html>